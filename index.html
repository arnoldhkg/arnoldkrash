<!doctype html>
<html lang="kk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>JUZ40TAR ‚Äî –°–∞–Ω–¥—ã“õ “õ–æ—Ä</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#9aa4b2;--accent:#4f46e5;--glass:rgba(255,255,255,0.03);color-scheme:dark}
    *{box-sizing:border-box}
    html,body,#app{height:100%;margin:0;font-family:Inter,system-ui,Roboto,Arial}
    body{background:linear-gradient(180deg,#071021 0%,#061426 100%);color:#e6eef8}
    header{display:flex;align-items:center;justify-content:space-between;padding:12px 20px}
    header h1{font-size:18px;margin:0}
    .top-actions{display:flex;gap:8px;align-items:center}
    .btn{background:var(--accent);color:white;padding:8px 12px;border-radius:8px;border:0;cursor:pointer;font-size:13px}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06)}
    .small{padding:6px 8px;font-size:12px}

    .wrap{height:calc(100% - 56px);display:flex;gap:12px;padding:20px}
    .sidebar{width:300px;background:var(--card);padding:14px;border-radius:12px;overflow:auto}
    .main{flex:1;background:transparent;padding:14px;border-radius:12px;overflow:auto}

    .subject-item{background:var(--glass);padding:10px;border-radius:10px;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center}
    .subject-item strong{display:block}

    .month-list{display:flex;flex-direction:column;gap:8px}
    .month-card{background:rgba(255,255,255,0.02);padding:12px;border-radius:10px;display:flex;flex-direction:column}
    .month-header{display:flex;justify-content:space-between;align-items:center}
    .week-list{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .week-pill{background:rgba(255,255,255,0.03);padding:6px 10px;border-radius:8px;cursor:pointer}

    .controls{display:flex;gap:8px}
    label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
    input,select,textarea{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.04);color:inherit;padding:8px;border-radius:8px;width:100%}
    .res-list{margin-top:10px;display:flex;flex-direction:column;gap:8px}
    .res-item{background:rgba(0,0,0,0.2);padding:8px;border-radius:8px;display:flex;justify-content:space-between;align-items:center}

    .mode-badge{font-size:13px;color:var(--muted);margin-left:8px}
    footer{padding:12px 20px;color:var(--muted);font-size:13px}

    .res-item {
  background: rgba(0, 0, 0, 0.2);
  padding: 8px;
  border-radius: 8px;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 8px;
  flex-wrap: wrap;
}

.res-item > div:first-child {
  flex: 1 1 auto;
  min-width: 180px;
  word-wrap: break-word;
  overflow-wrap: anywhere;
}

.res-item > div:last-child {
  flex-shrink: 0;
  display: flex;
  gap: 6px;
}

/* === –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Ü–≤–µ—Ç–∞ –¥–ª—è –ø”ô–Ω–¥–µ—Ä (—Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º) === */
.subject-item[data-name="–¢–∞—Ä–∏—Ö"] {
  background: #ff3300 !important;
  color: #fff !important;
}
.subject-item[data-name="–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞"] {
  background: #0008ff !important;
  color: #fff !important;
}
.subject-item[data-name="–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞"] {
  background: #00878a !important;
  color: #fff !important;
}
.subject-item[data-name="–ú–°"] {
  background: #00ffee !important;
  color: #000 !important;
}
.subject-item[data-name="–¢–∞—Ä–∏—Ö"]:hover {
  box-shadow: 0 0 10px #ff3300aa !important;
}
.subject-item[data-name="–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞"]:hover {
  box-shadow: 0 0 10px #0008ffaa !important;
}
.subject-item[data-name="–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞"]:hover {
  box-shadow: 0 0 10px #00878aaa !important;
}
.subject-item[data-name="–ú–°"]:hover {
  box-shadow: 0 0 10px #00ffeeaa !important;
}



    .overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(rgba(2,6,23,0.6),rgba(2,6,23,0.85));z-index:9999}
    .cardbox{background:#071022;padding:18px;border-radius:12px;min-width:320px}

    @media (max-width:800px){.wrap{flex-direction:column}.sidebar{width:100%}.main{width:100%}}
  </style>
</head>
<body>
  <header>
    <div style="display:flex;align-items:center;gap:12px">
      <h1>JUZ40TAR ‚Äî –°–∞–Ω–¥—ã“õ “õ–æ—Ä</h1>
      <div id="modeLabel" class="mode-badge"></div>
    </div>
    <div class="top-actions">
      <button class="btn small" id="addSubjectBtn" title="–ü”ô–Ω “õ–æ—Å—É">–ü”ô–Ω “õ–æ—Å—É</button>
      <button class="btn ghost small" id="settingsBtn" title="–ë–∞–ø—Ç–∞—É–ª–∞—Ä">–ë–∞–ø—Ç–∞—É–ª–∞—Ä</button>
    </div>
  </header>

  <div class="wrap" id="app">
    <aside class="sidebar">
      <label>–ü”ô–Ω–¥–µ—Ä</label>
      <div id="subjectsList"></div>
      <hr style="opacity:0.06;margin:12px 0"/>
      <label>–Ü–∑–¥–µ—É</label>
      <input id="searchInput" placeholder="–ê–π, –ê–ø—Ç–∞ –Ω–µ–º–µ—Å–µ —Ä–µ—Å—É—Ä—Å –±–æ–π—ã–Ω—à–∞ —ñ–∑–¥–µ—É" />
    </aside>

    <main class="main">
      <div id="mainContent">
        <p style="color:var(--muted)">–ê–ª–¥—ã–º–µ–Ω –ø”ô–Ω–¥—ñ —Ç–∞“£–¥–∞“£—ã–∑ (–Ω–µ–º–µ—Å–µ –∂–∞“£–∞ –ø”ô–Ω “õ–æ—Å—ã“£—ã–∑).</p>
      </div>
    </main>
  </div>

  <footer>Bar–ª—ã –¥–µ—Ä–µ–∫—Ç–µ—Ä —Å–µ–Ω—ñ“£ –±—Ä–∞—É–∑–µ—Ä—ñ“£–¥–µ —Å–∞“õ—Ç–∞–ª–∞–¥—ã. “ö“±–ø–∏—è–Ω—ã —Ä–µ–¥–∞–∫—Ç–æ—Ä ”©–∑–≥–µ—Ä–µ –∞–ª–∞–¥—ã.</footer>

  <!-- Login / role overlay -->
  <div id="loginOverlay" class="overlay">
    <div class="cardbox">
      <h3>–ö—ñ—Ä—É ‚Äî –†”©–ª</h3>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button class="btn" id="roleView">–¢–µ–∫ –∫”©—Ä—É</button>
        <div style="flex:1">
          <label>–†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥—ã</label>
          <input id="passInput" placeholder="–ö–æ–¥ –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑" />
          <div style="display:flex;gap:8px;margin-top:8px;justify-content:flex-end">
            <button class="btn" id="roleEdit">–ö—ñ—Ä—É (—Ä–µ–¥–∞–∫—Ç–æ—Ä)</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Settings modal -->
  <div id="settingsOverlay" class="overlay" style="display:none">
    <div class="cardbox">
      <h3>–ë–∞–ø—Ç–∞—É–ª–∞—Ä</h3>
      <div id="settingsContent">
        <div style="margin-top:8px">
          <label>–†–µ–¥–∞–∫—Ç–æ—Ä “õ“±–ø–∏—è—Å—ã (–∞“ì—ã–º–¥–∞“ì—ã)</label>
          <input id="currentPass" readonly />
          <label style="margin-top:8px">–ñ–∞“£–∞ “õ“±–ø–∏—è –∫–æ–¥ (—Ä–µ–¥–∞–∫—Ç–æ—Ä “ì–∞–Ω–∞)</label>
          <input id="newPass" placeholder="–ñ–∞“£–∞ –∫–æ–¥" />
          <div style="display:flex;gap:8px;margin-top:8px;justify-content:flex-end">
            <button class="btn" id="savePassBtn">–°–∞“õ—Ç–∞—É</button>
            <button class="btn ghost" id="closeSettings">–ñ–∞–±—É</button>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
(() => {
  // Config
  const STORAGE_KEY = 'juz40tar_data_v1';
  const PASS_KEY = 'juz40tar_pass_v1';
  const LAST_KEY = 'juz40tar_last_v1';
  const MAX_MONTHS = 7; const MAX_WEEKS = 4;
  const DEFAULT_PASS = '667667';

  // Elements
  const loginOverlay = document.getElementById('loginOverlay');
  const roleView = document.getElementById('roleView');
  const roleEdit = document.getElementById('roleEdit');
  const passInput = document.getElementById('passInput');
  const modeLabel = document.getElementById('modeLabel');

  const addSubjectBtn = document.getElementById('addSubjectBtn');
  const subjectsList = document.getElementById('subjectsList');
  const mainContent = document.getElementById('mainContent');
  const searchInput = document.getElementById('searchInput');

  const settingsBtn = document.getElementById('settingsBtn');
  const settingsOverlay = document.getElementById('settingsOverlay');
  const closeSettings = document.getElementById('closeSettings');
  const currentPass = document.getElementById('currentPass');
  const newPass = document.getElementById('newPass');
  const savePassBtn = document.getElementById('savePassBtn');

  let isEditor = false;
  let data = null;
  let current = {subjectId:null, monthId:null, weekId:null};

  // Helpers
 // ====== GITHUB –í–ï–†–°–ò–Ø ======
async function loadData(){
  try {
    const res = await fetch(`https://api.github.com/repos/arnoldhkg/arnoldkrash/contents/data.json`, {
      headers: {
        "Authorization": "token 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",
        "Accept": "application/vnd.github.v3+json"
      }
    });
    if (!res.ok) throw new Error("GitHub fetch error");
    const json = await res.json();
    const decoded = atob(json.content.replace(/\n/g,""));
    const data = JSON.parse(decoded);
    sessionStorage.setItem("GITHUB_SHA", json.sha);
    console.log("‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ GitHub");
    return data;
  } catch (e) {
    console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", e);
    return { "__subjects": [] };
  }
}

async function saveData(){
  try {
    const sha = sessionStorage.getItem("GITHUB_SHA");
    const body = {
      message: "update data.json via site",
      content: btoa(JSON.stringify(data, null, 2)),
      sha: sha
    };
    const res = await fetch(`https://api.github.com/repos/–¢–í–û–ô_–õ–û–ì–ò–ù/–¢–í–û–ô_–†–ï–ü–û/contents/data.json`, {
      method: "PUT",
      headers: {
        "Authorization": "token ghp_–¢–í–û–ô_–¢–û–ö–ï–ù",
        "Accept": "application/vnd.github.v3+json",
        "Content-Type": "application/json"
      },
      body: JSON.stringify(body)
    });
    const json = await res.json();
    sessionStorage.setItem("GITHUB_SHA", json.content.sha);
    console.log("üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ GitHub");
  } catch (e) {
    console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:", e);
    alert("‚ùå “ö–∞—Ç–µ: GitHub-“õ–∞ —Å–∞“õ—Ç–∞—É –º“Ø–º–∫—ñ–Ω –µ–º–µ—Å");
  }
}

  function loadPass(){ return localStorage.getItem(PASS_KEY) || DEFAULT_PASS; }
  function savePass(p){ localStorage.setItem(PASS_KEY, p); }
  function saveLast(){ localStorage.setItem(LAST_KEY, JSON.stringify(current)); }
  function loadLast(){ try{ const v = localStorage.getItem(LAST_KEY); return v?JSON.parse(v):{} }catch(e){return{}} }
  function uid(p='id'){ return p + '_' + Math.random().toString(36).slice(2,9); }
  function esc(s){ if(!s) return ''; return s.replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c])); }

  // Init
  function init(){ data = loadData(); const last = loadLast(); if(last.subjectId) current = last; renderSubjects(); updateModeLabel(); renderMain(); }

  // Role handlers
  roleView.addEventListener('click', ()=>{ isEditor=false; loginOverlay.style.display='none'; init(); });
  roleEdit.addEventListener('click', ()=>{ const pass = localStorage.getItem(PASS_KEY) || DEFAULT_PASS; if(passInput.value.trim()===pass){ isEditor=true; loginOverlay.style.display='none'; init(); } else alert('“ö–∞—Ç–µ –∫–æ–¥'); });

  // Subjects
  addSubjectBtn.addEventListener('click', ()=>{ if(!isEditor){ alert('–¢–µ–∫ —Ä–µ–¥–∞–∫—Ç–æ—Ä “õ–æ—Å–∞–¥—ã'); return; } const name = prompt('–ü”ô–Ω–Ω—ñ“£ –∞—Ç–∞—É—ã (–º—ã—Å: –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞)') || '–ñ–∞“£–∞ –ø”ô–Ω'; // add
    const id = uid('s'); data[id] = data[id] || []; // don't use dynamic keys in data object, keep subjects as map? We'll store subjects array in separate structure
    // For simplicity store subjects as array of objects under special key __subjects
    if(!data.__subjects) data.__subjects = [];
    data.__subjects.push({id,name,months:[]});
    saveData(); renderSubjects(); });

  function ensureSubjects(){ if(!data.__subjects){ // initialise default subjects
      data.__subjects = [
        {id:'history',name:'–¢–∞—Ä–∏—Ö',months:[]},
        {id:'math',name:'–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞',months:[]},
        {id:'cs',name:'–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞',months:[]},
        {id:'ms',name:'–ú–°',months:[]}
      ]; saveData(); }
  }

  function renderSubjects(filter=''){ ensureSubjects(); subjectsList.innerHTML=''; const list = data.__subjects.filter(s=> s.name.toLowerCase().includes(filter.toLowerCase())); list.forEach(s=>{
    const el = document.createElement('div'); el.className='subject-item'; el.innerHTML = `<div><strong>${esc(s.name)}</strong><div style="color:var(--muted)">–ê–π–ª–∞—Ä: ${s.months.length}</div></div>`;
    el.addEventListener('click', ()=>{ current.subjectId = s.id; current.monthId = null; current.weekId = null; saveLast(); renderMain(); });
    subjectsList.appendChild(el);
  });
  // small hint for editor: manage subjects
  if(isEditor){ const manage = document.createElement('div'); manage.style.marginTop='8px'; manage.innerHTML = '<button class="btn small" id="manageSubjectsBtn">–ü”ô–Ω–¥–µ—Ä–¥—ñ –±–∞—Å“õ–∞—Ä—É</button>'; subjectsList.appendChild(manage); document.getElementById('manageSubjectsBtn').addEventListener('click', manageSubjects); }
  }

  function manageSubjects(){ // simple list with rename/delete
    const html = data.__subjects.map(s=>`<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px"><div>${esc(s.name)}</div><div style="display:flex;gap:6px"><button class="btn ghost small" data-id="${s.id}" data-act="rename">”®“£–¥–µ—É</button><button class="btn ghost small" data-id="${s.id}" data-act="del">”®—à—ñ—Ä—É</button></div></div>`).join('');
    const ok = confirm('–ü”ô–Ω–¥–µ—Ä–¥—ñ –±–∞—Å“õ–∞—Ä—É: OK ‚Äî —Ç—ñ–∑—ñ–º –∞—à—ã–ª–∞–¥—ã, Cancel ‚Äî –±–æ–ª–¥—ã—Ä–º–∞—É'); if(!ok) return; const w = window.open('','_blank','width=520,height=620'); w.document.title='–ü”ô–Ω–¥–µ—Ä–¥—ñ –±–∞—Å“õ–∞—Ä—É'; w.document.body.style.background='#071022'; w.document.body.style.color='#e6eef8'; w.document.body.style.fontFamily='Inter,Arial'; w.document.body.innerHTML = `<div style="padding:12px"><h3>–ü”ô–Ω–¥–µ—Ä–¥—ñ –±–∞—Å“õ–∞—Ä—É</h3>${html}<div style="margin-top:12px"><button id="closeBtn">–ñ–∞–±—É</button></div></div>`; w.document.getElementById('closeBtn').addEventListener('click', ()=> w.close()); // event handlers in popup are non-essential
  }

  // Main content
  function renderMain(){ ensureSubjects(); if(!current.subjectId){ mainContent.innerHTML = '<p style="color:var(--muted)">–ü”ô–Ω —Ç–∞“£–¥–∞“£—ã–∑...</p>'; return; }
    const subj = data.__subjects.find(x=>x.id===current.subjectId);
    if(!subj) { current.subjectId=null; saveLast(); renderSubjects(); renderMain(); return; }
    // header
    let html = `<div style="display:flex;justify-content:space-between;align-items:center"><div><h2 style="margin:0">${esc(subj.name)}</h2><div style="color:var(--muted)">–ê–π–ª–∞—Ä: ${subj.months.length}</div></div>`;
    if(isEditor) html += `<div style="display:flex;gap:8px"><button class="btn" id="addMonth">–ê–π “õ–æ—Å—É</button><button class="btn ghost" id="clearAll">–ë–∞—Ä–ª—ã“ì—ã–Ω ”©—à—ñ—Ä—É</button></div>`;
    html += '</div>';
    // months
    html += '<div class="month-list" style="margin-top:12px">';
    if(subj.months.length===0) html += '<p style="color:var(--muted)">–ê–π–ª–∞—Ä –∂–æ“õ ‚Äî “õ–æ—Å—É –∞—Ä“õ—ã–ª—ã “õ–æ—Å—ã“£—ã–∑.</p>';
    subj.months.forEach((m,mi)=>{
      html += `<div class="month-card"><div class="month-header"><div><strong>${esc(m.title)}</strong><div style="color:var(--muted)">–ê–ø—Ç–∞–ª–∞—Ä: ${m.weeks.length}</div></div><div>`;

      if(isEditor) html += `<div style="display:flex;gap:8px"><button class="btn small" data-act="addWeek" data-mid="${m.id}">–ê–ø—Ç–∞ “õ–æ—Å—É</button><button class="btn ghost small" data-act="delMonth" data-mid="${m.id}">–ê–π–¥—ã ”©—à—ñ—Ä—É</button></div>`;
      html += `</div></div><div class="week-list">`;
      m.weeks.forEach((w,wi)=>{ html += `<div class="week-pill" data-mid="${m.id}" data-wid="${w.id}">${esc(w.title)}${isEditor? ' <small style="color:var(--muted)">√ó</small>':''}</div>`; });
      html += '</div></div>';
    });
    html += '</div>';

    mainContent.innerHTML = html;

    // hook buttons
    if(isEditor){ document.getElementById('addMonth').addEventListener('click', ()=>{ addMonth(subj.id); }); document.getElementById('clearAll').addEventListener('click', ()=>{ if(confirm('–ë–∞—Ä–ª—ã“õ –∞–π–ª–∞—Ä–¥—ã ”©—à—ñ—Ä—É?')){ subj.months=[]; saveData(); renderSubjects(); renderMain(); } }); }

    // add handlers for month-level buttons
    mainContent.querySelectorAll('[data-act="addWeek"]').forEach(btn=> btn.addEventListener('click', e=>{ const mid = e.currentTarget.dataset.mid; addWeek(subj.id, mid); }));
    mainContent.querySelectorAll('[data-act="delMonth"]').forEach(btn=> btn.addEventListener('click', e=>{ const mid = e.currentTarget.dataset.mid; if(confirm('–ê–π–¥—ã ”©—à—ñ—Ä—É?')){ subj.months = subj.months.filter(mm=> mm.id!==mid); saveData(); renderSubjects(); renderMain(); } }));

    // week click
    mainContent.querySelectorAll('.week-pill').forEach(p=> p.addEventListener('click', e=>{ const mid = p.dataset.mid; const wid = p.dataset.wid; openWeek(subj.id, mid, wid); }));

  }

  function addMonth(subjId){ const subj = data.__subjects.find(s=>s.id===subjId); if(!subj) return; if(subj.months.length>=MAX_MONTHS) return alert('–ú–∞–∫—Å –∞–π: ' + MAX_MONTHS); const num = subj.months.length+1; const m = {id:uid('m'), title:`–ê–π ${num}`, weeks:[]}; subj.months.push(m); saveData(); renderSubjects(); renderMain(); }

  function addWeek(subjId, monthId){ const subj = data.__subjects.find(s=>s.id===subjId); if(!subj) return; const m = subj.months.find(mm=>mm.id===monthId); if(!m) return; if(m.weeks.length>=MAX_WEEKS) return alert('–ú–∞–∫—Å –∞–ø—Ç–∞: ' + MAX_WEEKS); const num = m.weeks.length+1; const w = {id:uid('w'), title:`–ê–ø—Ç–∞ ${num}`, resources:[]}; m.weeks.push(w); saveData(); renderSubjects(); renderMain(); }

  function openWeek(subjId, monthId, weekId){ const subj = data.__subjects.find(s=>s.id===subjId); const m = subj.months.find(mm=>mm.id===monthId); const w = m.weeks.find(ww=>ww.id===weekId); current.subjectId = subjId; current.monthId = monthId; current.weekId = weekId; saveLast(); // render week editor/view
    let html = `<div style="display:flex;justify-content:space-between;align-items:center"><div><h3 style="margin:0">${esc(subj.name)} ‚Äî ${esc(m.title)} ‚Äî ${esc(w.title)}</h3><div style="color:var(--muted)">–†–µ—Å—É—Ä—Å—Ç–∞—Ä: ${w.resources.length}</div></div>`;
    if(isEditor) html += `<div style="display:flex;gap:8px"><button class="btn" id="addResBtn">–†–µ—Å—É—Ä—Å “õ–æ—Å—É</button><button class="btn ghost" id="delWeekBtn">–ê–ø—Ç–∞–Ω—ã ”©—à—ñ—Ä—É</button></div>`;
    html += '</div>';
    // resources list
    html += '<div style="margin-top:12px">';
    if(w.resources.length===0) html += '<p style="color:var(--muted)">–†–µ—Å—É—Ä—Å—Ç–∞—Ä –∂–æ“õ.</p>';
    else{ html += '<div class="res-list">'; w.resources.forEach(r=>{ html += `<div class="res-item"><div><strong>${esc(r.title)}</strong><div style="color:var(--muted)">${esc(r.url)}</div></div><div style="display:flex;gap:8px"><button class="btn ghost small" data-rid="${r.id}" data-act="open">–ê—à—É</button><button class="btn ghost small" data-rid="${r.id}" data-act="copy">–ö”©—à—ñ—Ä—É</button><button class="btn ghost small" data-rid="${r.id}" data-act="del">”®—à—ñ—Ä—É</button></div></div>`; }); html += '</div>'; }
    html += '</div>';
    mainContent.innerHTML = html;

    if(isEditor){ document.getElementById('addResBtn').addEventListener('click', ()=>{ const title = prompt('–†–µ—Å—É—Ä—Å –∞—Ç–∞—É—ã (–Ω–µ–º–µ—Å–µ –±–æ—Å “õ–∞–ª–¥—ã—Ä—É)') || ''; const url = prompt('URL (https://...)') || ''; if(!url) return alert('URL –∫–µ—Ä–µ–∫'); // add
        w.resources.push({id:uid('r'), title: title||url, url}); saveData(); openWeek(subjId, monthId, weekId); });
      document.getElementById('delWeekBtn').addEventListener('click', ()=>{ if(confirm('–ê–ø—Ç–∞–Ω—ã ”©—à—ñ—Ä—É?')){ m.weeks = m.weeks.filter(ww=>ww.id!==weekId); saveData(); renderSubjects(); renderMain(); } }); }

    // resource buttons
    mainContent.querySelectorAll('[data-act="open"]').forEach(b=> b.addEventListener('click', e=>{ const rid = e.currentTarget.dataset.rid; const r = w.resources.find(rr=>rr.id===rid); if(r) window.open(r.url,'_blank'); }));
    mainContent.querySelectorAll('[data-act="copy"]').forEach(b=> b.addEventListener('click', e=>{ const rid = e.currentTarget.dataset.rid; const r = w.resources.find(rr=>rr.id===rid); if(r){ navigator.clipboard.writeText(r.url).then(()=> alert('–°—ñ–ª—Ç–µ–º–µ –∫”©—à—ñ—Ä—ñ–ª–¥—ñ')); } }));
    mainContent.querySelectorAll('[data-act="del"]').forEach(b=> b.addEventListener('click', e=>{ const rid = e.currentTarget.dataset.rid; if(confirm('–†–µ—Å—É—Ä—Å—Ç—ã ”©—à—ñ—Ä—É?')){ m.weeks = m.weeks.map(ww=> ww.id===m.id? ww: ww); // noop
        w.resources = w.resources.filter(rr=> rr.id!==rid); saveData(); openWeek(subjId, monthId, weekId); } }));
  }

  // Search
  searchInput.addEventListener('input', e=>{ const q = e.target.value.trim().toLowerCase(); if(!q){ renderSubjects(); renderMain(); return; } // filter subjects by month/week/resource
    ensureSubjects(); subjectsList.innerHTML=''; data.__subjects.forEach(s=>{ // find matches
      const match = s.name.toLowerCase().includes(q) || s.months.some(m=> m.title.toLowerCase().includes(q) || m.weeks.some(w=> w.title.toLowerCase().includes(q) || w.resources.some(r=> r.title.toLowerCase().includes(q) || r.url.toLowerCase().includes(q) )));
      if(match){ const el = document.createElement('div'); el.className='subject-item'; el.innerHTML = `<div><strong>${esc(s.name)}</strong><div style="color:var(--muted)">–ê–π–ª–∞—Ä: ${s.months.length}</div></div>`; el.addEventListener('click', ()=>{ current.subjectId = s.id; current.monthId=null; current.weekId=null; saveLast(); renderMain(); }); subjectsList.appendChild(el); }
    });
  });

  // Settings
  settingsBtn.addEventListener('click', ()=>{ if(!isEditor){ alert('–¢–µ–∫ —Ä–µ–¥–∞–∫—Ç–æ—Ä –±–∞–ø—Ç–∞–π –∞–ª–∞–¥—ã'); return; } settingsOverlay.style.display='flex'; currentPass.value = loadPass(); });
  closeSettings.addEventListener('click', ()=> settingsOverlay.style.display='none');
  savePassBtn.addEventListener('click', ()=>{ const np = newPass.value.trim(); if(!np) return alert('–ñ–∞“£–∞ –∫–æ–¥ –µ“£–≥—ñ–∑—ñ“£—ñ–∑'); savePass(np); alert('“ö“±–ø–∏—è –∂–∞“£–∞—Ä—Ç—ã–ª–¥—ã'); currentPass.value = loadPass(); newPass.value=''; settingsOverlay.style.display='none'; });

  // Utils
  function updateModeLabel(){ modeLabel.textContent = isEditor ? '–†–µ–∂–∏–º: —Ä–µ–¥–∞–∫—Ç–æ—Ä' : '–†–µ–∂–∏–º: –∫”©—Ä—É'; }

  // Start
  window.addEventListener('load', ()=>{ // ensure password stored if not
    if(!localStorage.getItem(PASS_KEY)) localStorage.setItem(PASS_KEY, DEFAULT_PASS);
    loginOverlay.style.display='flex';
  });

})();
</script>
</body>
</html>


